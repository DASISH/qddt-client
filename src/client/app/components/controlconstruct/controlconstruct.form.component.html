<div *ngIf="controlConstruct" class="card">
  <form (ngSubmit)="onSaveControlConstruct()" #qcform="ngForm">
    <div class="row">
      <div class="col s2 offset-s10">
        <label class="active teal-text text-align: right">
          Version {{controlConstruct?.version?.major}}.{{controlConstruct?.version?.minor}}
          <i *ngIf="controlConstruct.workinprogress"class="material-icons white yellow-text tiny" title="In development">error</i>
        </label>
      </div>
      <div class="col s12">
        <div class="input-field">
          <!--<input id="controlConstructName" name="{{controlConstruct.id}}-name"-->
                 <!--type="text" class="validate"  [(ngModel)]="controlConstruct.name" required>-->
          <!--<label [ngClass]="{'active': controlConstruct.name}" for="controlConstructName" >Name</label>-->

          <label [attr.for]="controlConstruct.id + '-name'"
                 class="active teal-text">Name
          </label>
          <textarea [attr.id]="controlConstruct.id + '-name'"
                    name="{{controlConstruct.id}}-name" class="materialize-textarea"
                    [(ngModel)]="controlConstruct.name" [attr.maxlength]="255"
                    required>
          </textarea>
        </div>
      </div>
    </div>
    <div class="nomargin">
      <ul class="hoverable"
          (mouseenter)="showPreinstructionButton = !readonly"
          (mouseleave)="showPreinstructionButton = false">
        <li>
          <div class="row">
            <div class="col s11"><label class="teal-text">Pre Instructions</label></div>
            <div class="col s1">
              <a [ngClass]="{hide: !showPreinstructionButton}"
                 class="btn-flat btn-floating btn-small waves-effect waves-light teal"
                 (click)="createPreInstruction=!createPreInstruction">
                <i class="material-icons">add</i>
              </a>
            </div>
          </div>
        </li>
        <li class="collection-item" *ngIf="createPreInstruction">
          <qddt-instruction-create (createInstructionEvent)="onAddPreInstruction($event)">
          </qddt-instruction-create>
        </li>
        <li class="collection-item" *ngFor="let instruction of controlConstruct.preInstructions; let idx=index">
          <div class="row"
               (mouseenter)="instruction.showbutton = !readonly"
               (mouseleave)="instruction.showbutton = false">
            <div class="col s11">{{instruction?.description}}</div>
            <div class="col s1">
              <a [ngClass]="{hide: !showPreinstructionButton}"
                 class="modal-trigger btn-flat btn-floating btn-medium waves-effect waves-light teal"
                 (click)="onDeletePreInstruction(idx)">
                <i class="material-icons">remove</i>
              </a>
            </div>
          </div>
        </li>
      </ul>
    </div>

    <div class="hoverable"
         (mouseenter)="showQuestionButton = !readonly"
         (mouseleave)="showQuestionButton = false">
      <div class="row">

        <div class="col s11"><label class="teal-text">Question Text (Version
          {{controlConstruct?.questionItem?.version?.major}}.{{controlConstruct?.questionItem?.version?.minor}})</label>
          <!--<label ngIf="!controlConstruct?.questionItem" class="teal-text">Question Text</label>-->
        </div>
        <div class="col s1">
          <a [ngClass]="{hide: !showQuestionButton}"
             class="btn-flat btn-floating btn-small waves-effect waves-light teal"
             (click)="editQuestoinItem = !editQuestoinItem;savedquestionitem=controlConstruct.questionItem;">
            <i *ngIf="controlConstruct.questionItem"class="material-icons">play_for_work</i>
            <i *ngIf="!controlConstruct.questionItem" class="material-icons">add</i>
          </a>
        </div>
      </div>
      <div class="row">
        <div class="col s11">
          <div class="flow-text">{{controlConstruct?.questionItem?.question?.question}}</div>
        </div>
        <div class="col s1">
          <a [ngClass]="{hide: !showQuestionButton}"
             class="btn-flat btn-floating btn-small waves-effect waves-light teal"
             (click)="onRemoveQuestoinItem()">
            <i class="material-icons">remove</i>
          </a>
        </div>
      </div>
      <qddt-control-construct-questionitem-select
        *ngIf="editQuestoinItem"
        (dismissEvent)="editQuestoinItem = false;controlConstruct.questionItem=savedquestionitem;"
        (useQuestionItemEvent) = "onUseQuestionItem($event)"
        [controlConstruct]="controlConstruct">
      </qddt-control-construct-questionitem-select>
    </div>
    <div class="nomargin">
      <ul class="hoverable"
          (mouseenter)="showPostinstructionButton = !readonly"
          (mouseleave)="showPostinstructionButton = false">
        <li>
          <div class="row">
            <div class="col s11"><label class="teal-text">Post Instructions</label></div>
            <div class="col s1">
              <a [ngClass]="{hide: !showPostinstructionButton}"
                 class="btn-flat btn-floating btn-small waves-effect waves-light teal"
                 (click)="createPostInstruction=!createPostInstruction">
                <i class="material-icons">add</i>
              </a>
            </div>
          </div>
        </li>
        <li class="collection-item" *ngIf="createPostInstruction">
          <qddt-instruction-create (createInstructionEvent)="onAddPostInstruction($event)">
          </qddt-instruction-create>
        </li>
        <li class="collection-item" *ngFor="let instruction of controlConstruct.postInstructions; let idx=index">
          <div class="row"
               (mouseenter)="instruction.showbutton = !readonly"
               (mouseleave)="instruction.showbutton = false">
            <div class="col s11">{{instruction?.description}}</div>
            <div class="col s1">
              <a [ngClass]="{hide: !showPostinstructionButton}"
                 class="modal-trigger btn-flat btn-floating btn-medium waves-effect waves-light teal"
                 (click)="onDeletePostInstruction(idx)">
                <i class="material-icons">remove</i>
              </a>
            </div>
          </div>
        </li>
      </ul>
    </div>

    <qddt-responsedomain-preview
      *ngIf="controlConstruct.questionItem && controlConstruct.questionItem.responseDomain"
      [isVisible]="true" [responseDomain]="controlConstruct.questionItem.responseDomain">
    </qddt-responsedomain-preview>

    <div class="row card">
      <div class="row">
        <div class="col s6">
          <a class="waves-effect waves-light btn"
             (click)="showUploadFileForm=!showUploadFileForm">File Upload</a>
        </div>
      </div>
      <div class="row" *ngIf="showUploadFileForm && !readonly">
        <div class="file-field input-field">
          <div class="btn">
            <span>File</span>
            <input type="file" (change)="onSelectFile($event)">
          </div>
          <div class="file-path-wrapper">
            <input class="file-path validate" type="text" placeholder="Upload one file">
          </div>
        </div>
        <a *ngIf="files" class="btn-flat right btn-floating btn-medium waves-effect waves-light teal"
           (click)="onUploadFile()">
          <i class="material-icons left medium">done</i>
        </a>
      </div>
      <div class="row hoverable">
        <ul>
          <li *ngFor="let m of controlConstruct.otherMaterials; let idx=index;">
            <div class="row"
                 (mouseenter)="m.showbutton = !readonly"
                 (mouseleave)="m.showbutton = false">
              <div class="col s10">
                <a class="waves-effect waves-light" (click)="onDownloadFile(m)">{{m.originalName}}</a>
              </div>
              <div class="col s2 right">
                <a class="btn-flat btn-floating btn-medium waves-effect waves-light teal"
                   [ngClass]="{hide: !m.showbutton}"
                   (click)="onDeleteFile(idx)">
                  <i class="material-icons left medium" title="Delete" >delete_forever</i>
                </a>
              </div>
            </div>
          </li>
          <li *ngFor="let file of fileStore; let idx=index;">
            <div class="row"
                 (mouseenter)="file.showbutton = !readonly"
                 (mouseleave)="file.showbutton = false">
              <div class="col s10">
                <a class="waves-effect waves-light">{{file[0]?.name}}</a>
              </div>
              <div class="col s2 right">
                <a class="btn-flat btn-floating btn-medium waves-effect waves-light teal"
                   [ngClass]="{hide: !file.showbutton}"
                   (click)="onDeleteFileFromLocal(idx)">
                  <i class="material-icons left medium" title="Delete" >delete_forever</i>
                </a>
              </div>
            </div>
          </li>
        </ul>
      </div>
    </div>

    <div class="row" *ngIf="!readonly">
      <qddt-rational [element]="controlConstruct"></qddt-rational>
    </div>

    <div class="row">
      <qddt-revision-detail [element]="controlConstruct"
                            (BasedonObjectDetail)="onBasedonObjectDetail($event)"
                            [type]="'controlconstruct'">
      </qddt-revision-detail>
    </div>

    <button *ngIf="!readonly" type="submit" class="btn btn-default">Submit</button>
  </form>
  <div class="modal modal-fixed-footer"
       materialize="modal" [materializeActions]="basedonActions">
    <div class="modal-content">
      <h4>Basedon Object Detail</h4>
      <div class="row" *ngIf="basedonObject">
        <qddt-control-construct-form
          [readonly]="true"
          [controlConstruct]="basedonObject">
        </qddt-control-construct-form>
      </div>
    </div>
    <div class="modal-footer">
      <button id="controlConstructs-modal-close"
              class="btn btn-default red modal-action modal-close waves-effect">
        <a><i class="close material-icons medium white-text">close</i></a>
      </button>
    </div>
  </div>
</div>
